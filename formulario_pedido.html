<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Pedido</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <link rel="stylesheet" href="styles_form.css">
</head>
<body>
    <!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>TiendatodoGo</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="styles.css">
	<script src="./script.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div id="floating-message">
        ENVÍO GRATIS Y CONTRA ENTREGA
    </div>
    <div class="container">
        <h1>Formulario de Pedido</h1>
        <form id="order-form">
            <div class="mb-3">
                <label for="customer-name" class="form-label">Nombre completo</label>
                <input type="text" id="customer-name" class="form-control" placeholder="Ingresa tu nombre" required>
            </div>
            <div class="mb-3">
                <label for="customer-email" class="form-label">Correo electrónico</label>
                <input type="email" id="customer-email" class="form-control" placeholder="Ingresa tu correo" required>
            </div>
            <div class="mb-3">
                <label for="customer-phone" class="form-label">Número de WhatsApp</label>
                <input type="tel" id="customer-phone" class="form-control" placeholder="Ingresa tu número de WhatsApp" required>
            </div>
            <div class="mb-3">
                <label for="customer-department" class="form-label">Departamento</label>
                <select id="customer-department" class="form-select" required>
                    <option value="">Selecciona un departamento</option>
                    <!-- Aquí van los departamentos -->
                    <option value="Amazonas">Amazonas</option>
                    <option value="Antioquia">Antioquia</option>
                    <option value="Arauca">Arauca</option>
                    <option value="Atlántico">Atlántico</option>
                    <option value="Bolívar">Bolívar</option>
                    <option value="Boyacá">Boyacá</option>
                    <option value="Caldas">Caldas</option>
                    <option value="Caquetá">Caquetá</option>
                    <option value="Casanare">Casanare</option>
                    <option value="Cauca">Cauca</option>
                    <option value="Cesar">Cesar</option>
                    <option value="Chocó">Chocó</option>
                    <option value="Córdoba">Córdoba</option>
                    <option value="Cundinamarca">Cundinamarca</option>
                    <option value="Guainía">Guainía</option>
                    <option value="Guaviare">Guaviare</option>
                    <option value="Huila">Huila</option>
                    <option value="La Guajira">La Guajira</option>
                    <option value="Magdalena">Magdalena</option>
                    <option value="Meta">Meta</option>
                    <option value="Nariño">Nariño</option>
                    <option value="Norte de Santander">Norte de Santander</option>
                    <option value="Putumayo">Putumayo</option>
                    <option value="Quindío">Quindío</option>
                    <option value="Risaralda">Risaralda</option>
                    <option value="Santander">Santander</option>
                    <option value="Sucre">Sucre</option>
                    <option value="Tolima">Tolima</option>
                    <option value="Valle del Cauca">Valle del Cauca</option>
                    <option value="Vaupés">Vaupés</option>
                    <option value="Vichada">Vichada</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="customer-city" class="form-label">Ciudad</label>
                <input type="text" id="customer-city" class="form-control" placeholder="Ingresa tu ciudad" required>
            </div>
            <div class="mb-3">
                <label for="customer-address" class="form-label">Dirección de la casa</label>
                <textarea id="customer-address" class="form-control" rows="3" placeholder="Ingresa tu dirección completa" required></textarea>
            </div>
            <h5>Resumen del Pedido</h5>
            <ul id="order-summary" class="list-group mb-3">
                <!-- Los productos se llenarán dinámicamente aquí -->
            </ul>
            <button type="submit" class="btn btn-success w-100">Enviar Pedido</button>
        </form>
    </div>
        <script>
        // Inicializar EmailJS
        (function() {
            emailjs.init('d-fR1pEG4oWTsziPP'); // Reemplaza 'd-fR1pEG4oWTsziPP' con tu ID de usuario de EmailJS
        })();

        // Obtener datos del carrito almacenados en sessionStorage
        const cart = JSON.parse(sessionStorage.getItem('cart')) || [];
        const orderSummary = document.getElementById('order-summary');

        if (cart.length === 0) {
            orderSummary.innerHTML = '<li class="list-group-item">El carrito está vacío.</li>';
        } else {
            cart.forEach(item => {
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item';
                listItem.textContent = `${item.name} (x${item.quantity}) - $${(item.price * item.quantity).toFixed(2)}`;
                orderSummary.appendChild(listItem);
            });
        }

        // Manejar el envío del formulario
        document.getElementById('order-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const name = document.getElementById('customer-name').value;
            const email = document.getElementById('customer-email').value;
            const phone = document.getElementById('customer-phone').value;
            const department = document.getElementById('customer-department').value;
            const city = document.getElementById('customer-city').value;
            const address = document.getElementById('customer-address').value;

            // Crear el cuerpo del correo
            const orderDetails = cart.map(item => `${item.name} (x${item.quantity}) - $${(item.price * item.quantity).toFixed(2)}`).join('\n');

            const emailParams = {
                customer_name: name,
                customer_email: email,
                customer_phone: phone,
                customer_department: department,
                customer_city: city,
                customer_address: address,
                order_details: orderDetails
            };

            // Enviar el correo usando EmailJS
            emailjs.send('service_ny7sdps', 'template_nswdtnr', emailParams)
                .then(() => {
                    alert('Pedido enviado con éxito. Pronto nos pondremos en contacto contigo.');
                    sessionStorage.removeItem('cart'); // Limpiar el carrito
                    window.location.href = 'index.html'; // Redirigir a la página principal
                })
                .catch(error => {
                    console.error('Error al enviar el pedido:', error);
                    alert('Hubo un problema al enviar tu pedido. Intenta nuevamente.');
                });
        });
    </script>
</body>
</html>
